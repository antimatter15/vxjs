<title>Build Your Own vX!</title>
<h1>Build You Own vX!</h1>
<p>Customize your vX! Select the packages you want.</p>

<script type="text/javascript" src="lib/vx.all.js"></script>
<script type="text/javascript">

var selmod = []
var modsrc = {};
var modules = {};
var header = "_={\n";
var end = "\n}";

_.R(function(){
  _.X("modules.json?"+_.Q({ck: Math.random()}),function(json){
    _.G("selectmodules").innerHTML="";
    modules = _.S(json,true);
    for(var x in modules){
      var mod = modules[x];
      var tpl = {
        x: x,
        title: mod.desc.replace(/\'/g,'\\\''),
        name: mod.name 
      }
      _.G("selectmodules").innerHTML+=
      _.M('<input id={x} type=checkbox name={x}><label for={x} title="{title}">{name}</label><br>',tpl)
    }
    for(var x in modules){
      _.E(_.G(x), "click", function(){
        checkmods();
      })
    }
  })
})


function checkmods(){
  for(var k in modules){
    if(_.G(k).checked && _.I(k,selmod) == -1){ //needs inArray functionality
      selmod.push(k);
      for(var y = 0; y < modules[k].dep.length; y++){
        _.G(modules[k].dep[y]).checked = true;
        checkmods();
      }
    }
    if(_.G(k).checked == false && _.I(k,selmod) != -1){
      selmod.splice(_.I(k,selmod),1); //remove from array
    }
  }
  for(var i = 0; i < selmod.length; i++){
    if(!modsrc[selmod[i]]){
      loadmod(selmod[i]);
    }
  }
  rebuild();
}

function loadmod(mod){
  _.X("lib/vx."+mod+".js?"+_.Q({ck: Math.random()}), function(e){
    modsrc[mod] = e;
    rebuild()
  })
}

function rebuild(){
  var code = "";
  var mods = [];
  
  for(var u = 0; u < selmod.length; u++){
    mods.push(modules[selmod[u]].fn+":"+modsrc[selmod[u]]+((selmod.length-u==1)?"":","))
  }
  
  code += mods.join("\n");
  
  code=(code.length>0)?(header+code+end):"/*No Modules Selected*/"
  _.G("build").value = code
  _.G("size").innerHTML = "Size: "+code.length+" bytes";
}


</script>
<div id="selectmodules">Loading Module List...</div>
<br>
<span id="size">Size: 23 bytes</span><br>
<textarea id="build" style="width: 100%; height: 500px">
/*No Modules Selected*/
</textarea>
